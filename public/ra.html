<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Resume Analyzer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>




  <style>
    .section-box {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      background: #f8f9fa;
    }
    textarea {
      resize: vertical;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Student Collaboration</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link" href="#">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Friend</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Group</a></li>
          <li class="nav-item"><a class="nav-link" href="#">GD</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Resume</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Bot</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Games</a></li>
          <li class="nav-item"><a class="nav-link" href="#">Admin</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="section-box">
      <h4>Upload Resume (.txt, .pdf, .docx)</h4>
      <input type="file" id="fileInput" accept=".txt,.pdf,.docx" class="form-control mb-2">
      <button onclick="readFile()" class="btn btn-primary">Read Resume</button>
    </div>

    <div class="section-box">
      <h4>Edit Resume</h4>
      <textarea id="resumeText" class="form-control" rows="10" placeholder="Paste or edit your resume here..."></textarea>
    </div>

    <div class="section-box text-center">
      <button onclick="analyze()" class="btn btn-success">Analyze Resume</button>
      <button onclick="downloadResumePDF()" class="btn btn-secondary ms-2">Download Resume (PDF)</button>
      <button onclick="downloadReportPDF()" class="btn btn-info ms-2">Download Report (PDF)</button>
    </div>

    <div id="results" style="display:none;">
      <div class="section-box"><h4>Summary</h4><p id="summary"></p></div>
      <div class="section-box"><h4>Skills</h4><p id="skills"></p></div>
      <div class="section-box"><h4>Strengths</h4><p id="strengths"></p></div>
      <div class="section-box"><h4>Weaknesses</h4><p id="weaknesses"></p></div>
      <div class="section-box"><h4>Score</h4><p id="score"></p></div>
      <div class="section-box"><h4>Ranking</h4><p id="ranking"></p></div>
      <div class="section-box"><h4>Improvements</h4><p id="improvements"></p></div>
      <div class="section-box"><h4>Career Path</h4><p id="career"></p></div>
      <div class="section-box"><h4>Job Suggestions</h4><p id="jobs"></p></div>
    </div>

    <div class="section-box">
      <canvas id="resumeChart"></canvas>
    </div>
  </div>

  <script>
    function readFile() {
      const file = document.getElementById("fileInput").files[0];
      const reader = new FileReader();
      if (!file) return;
      if (file.name.endsWith(".txt")) {
        reader.onload = () => document.getElementById("resumeText").value = reader.result;
        reader.readAsText(file);
      } else if (file.name.endsWith(".pdf")) {
        const pdfReader = new FileReader();
        pdfReader.onload = async () => {
          const pdf = await pdfjsLib.getDocument({ data: pdfReader.result }).promise;
          let text = "";
          for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const content = await page.getTextContent();
            text += content.items.map(item => item.str).join(" ") + "\n";
          }
          document.getElementById("resumeText").value = text;
        };
        pdfReader.readAsArrayBuffer(file);
      } else if (file.name.endsWith(".docx")) {
        reader.onload = async () => {
          const result = await mammoth.extractRawText({ arrayBuffer: reader.result });
          document.getElementById("resumeText").value = result.value;
        };
        reader.readAsArrayBuffer(file);
      } else {
        alert("Unsupported file format!");
      }
    }

    async function analyze() {
      const resumeText = document.getElementById("resumeText").value.trim();
      if (!resumeText) return alert("Please provide resume text.");

      const prompt = `Analyze this resume and return JSON only in this format:\n{\n  "summary": "...",\n  "skills": "...",\n  "strengths": "...",\n  "weaknesses": "...",\n  "score": 85,\n  "ranking": 8,\n  "improvements": "...",\n  "career_path": "...",\n  "job_suggestions": "..."\n}\nResume:\n${resumeText}`;

      try {
        const response = await fetch("https://tigerbhasha.onrender.com/api/openai", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "x-user-token": "tigerbhasha",
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [{ role: "user", content: prompt }]
          })
        });

        const result = await response.json();
        let textResponse = result.choices?.[0]?.message?.content || result;
        const jsonMatch = textResponse.match(/\{[\s\S]*?\}/);
        const data = jsonMatch ? JSON.parse(jsonMatch[0]) : {};

        document.getElementById("summary").textContent = data.summary || "N/A";
        document.getElementById("skills").textContent = data.skills || "N/A";
        document.getElementById("strengths").textContent = data.strengths || "N/A";
        document.getElementById("weaknesses").textContent = data.weaknesses || "N/A";
        document.getElementById("score").textContent = data.score || "N/A";
        document.getElementById("ranking").textContent = data.ranking || "N/A";
        document.getElementById("improvements").textContent = data.improvements || "N/A";
        document.getElementById("career").textContent = data.career_path || "N/A";
        document.getElementById("jobs").textContent = data.job_suggestions || "N/A";

        document.getElementById("results").style.display = "block";

        const ctx = document.getElementById("resumeChart").getContext("2d");
        new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["Score", "Ranking"],
            datasets: [{
              label: "Resume Metrics",
              data: [data.score || 0, data.ranking || 0],
              backgroundColor: ["#0d6efd", "#198754"]
            }]
          }
        });

      } catch (err) {
        alert("Error analyzing resume. See console for details.");
        console.error(err);
      }
    }

    function downloadResumePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const resumeText = document.getElementById("resumeText").value;
      doc.text(resumeText, 10, 10);
      doc.save("resume.pdf");
    }

    function downloadReportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let y = 10;
      const fields = ["summary", "skills", "strengths", "weaknesses", "score", "ranking", "improvements", "career", "jobs"];
      fields.forEach(id => {
        const title = id.charAt(0).toUpperCase() + id.slice(1);
        const text = document.getElementById(id).textContent;
        doc.text(`${title}: ${text}`, 10, y);
        y += 10;
      });
      doc.save("resume_analysis.pdf");
    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  
<footer class="text-center p-3" style="background-color: #f1f1f1;">
  <!-- Small Image that triggers Modal -->
  <img src="shannu.jpg" alt="Shanmuka" style="height: 30px; cursor: pointer;" data-bs-toggle="modal" data-bs-target="#imageModal">
  Â© 2025 E.SHANMUKA | Academe Hub
</footer>

<!-- Modal for full image -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body text-center">
        <img src="shannu.jpg" alt="Shanmuka Full" class="img-fluid">
      </div>
    </div>
  </div>
</div>

</body>
</html>
